<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<style>
canvas {
    background-color: #ffe2c2;
	animation: change-color-anim 30s ease-in;
}

@keyframes change-color-anim {
	0.0%{
		background-color: #15102d;
	}
    12.5%{
		background-color: #2D1D7A;
	}
    25.0%{
		background-color: #573170;
	}
    37.5%{
		background-color: #804565;
	}
    50.0%{
		background-color: #AA585B;
	}
    62.5%{
		background-color: #D36C50;
	}
    75.0%{
		background-color: #FD8046;
	}
    87.5%{
		background-color: #ffbc74;
	}
    100%{
		background-color: #ffe2c2;
	}
}
</style>
</head>
<body onload="startGame()">
<script>

var myGamePiece;
var myGamePowerup;
var myGameObstacle;
var varSpeed = 1;
const pieces=[];
const enemies= [];
const friends= [];
var isCollidingVar;
var newFriend = false;
var enemySpeed = 1;
var loss = false;

function random(n) {
      return Math.floor(Math.random()*n);
}
//if the collision is true, what all needs to be updated?


function startGame() {
    myGameArea.start();
    myGamePiece = new component(30, 30, "blue", 10, 120, 1);
    myGamePowerup = new component(30, 30, "green", 100, 120, 3);
    myGameObstacle = new component(30, 30, "red", 200, 120, 3);
    pieces.push(myGameObstacle);
    pieces.push(myGamePowerup);
    setTimeout(youLose, 30000);
}

var myGameArea = {
    canvas : document.createElement("canvas"),
    start : function() {
        this.canvas.width = 480;
        this.canvas.height = 270;
        this.context = this.canvas.getContext("2d");
        document.body.insertBefore(this.canvas, document.body.childNodes[0]);
        this.interval = setInterval(updateGameArea, 20);
        window.addEventListener('keydown', function (e) {
            myGameArea.key = e.keyCode;
        })
        window.addEventListener('keyup', function (e) {
            myGameArea.key = false;
        })
    }, 
    clear : function(){
        this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);
    }
}



function component(width, height, color, x, y, type) {
    this.gamearea = myGameArea;
    this.width = width;
    this.height = height;
    this.speedX = 0;
    this.speedY = 0;    
    this.x = x;
    this.y = y;
    this.type = type;
    this.update = function() {
        ctx = myGameArea.context;
        ctx.fillStyle = color;
        ctx.fillRect(this.x, this.y, this.width, this.height);
    }
    this.newPos = function() {
        this.x += this.speedX;
        this.y += this.speedY;        
    }
    //this functions checks if the position of one piece overlaps with another
    this.isColliding = function(collidingBlock) {
    if (
      this.x < collidingBlock.x + collidingBlock.width &&
      this.x + this.width > collidingBlock.x &&
      this.y < collidingBlock.y + collidingBlock.height &&
      this.height + this.y > collidingBlock.y
    ) {
        //if colliding, change speed to 3 or 0.5 depending on type
       // console.log("collide = true");
        return true;
    }
        //if not colliding, keep speed at 1
     //   console.log("collide = false");
        varSpeed = 1;
        return false;
  }   
}

function updateGameArea() {
    myGameArea.clear();
    myGamePiece.speedX = 0;
    myGamePiece.speedY = 0;    
    
    //console.log(isCollidingVar);
    if(isCollidingVar){
    varSpeed = pieces[isCollidingVar].type;
    }

    if (myGameArea.key && myGameArea.key == 37) {myGamePiece.speedX = (-1 * varSpeed); }
    if (myGameArea.key && myGameArea.key == 39) {myGamePiece.speedX = (1 * varSpeed); }
    if (myGameArea.key && myGameArea.key == 38) {myGamePiece.speedY = (-1 * varSpeed); }
    if (myGameArea.key && myGameArea.key == 40) {myGamePiece.speedY = (1 * varSpeed); }
    myGamePiece.newPos();    
    myGamePiece.update();

    //make a new invader, prob inside the update function
    //friends will hold components that are friends
    if(friends.length < 4){
    friends.push(new component(30, 30, "green",
    random(480)+480, random(270)-20));
    //random(myGameArea.canvas.width), random(canvas.height)));
    }

    if(enemies.length < 4){
    enemies.push(new component(30, 30, "red",
    random(480)+480, random(270)-20));
    //random(myGameArea.canvas.width), random(canvas.height)));
    }
    //this logic will allow you to update the position of each piece without calling 
    //every single one, you can add the original players piece to the array too
    isCollidingVar = 0;
    for (var i = 0; i<pieces.length; i++){
        //the second cube is being marked at collising but the value is
        pieces[i].newPos();
        pieces[i].update(); 
        //  if collision us true, store the value of the index that caused the collision
        if(myGamePiece.isColliding(pieces[i])){
            isCollidingVar = i;
           // console.log(isCollidingVar);
        }
    }   
 
    for (var i = 0; i<enemies.length; i++){
        //add logic to take away first in array if the arrau is 10+
        if (enemies[i].x < -10 ){
            enemies.splice(i, 1);
            //this is where you would add logic to gain points
        }
        if(myGamePiece.isColliding(enemies[i])){
            loss = true;
        }
        //the second cube is being marked at colliding but the value is
        //actually move each cube
        enemies[i].x -= 1;

        //update position
        enemies[i].newPos();
        enemies[i].update(); 
    } 

    for (var i = 0; i<friends.length; i++){
        //add logic to take away first in array if the the cube reaches the end
        if (friends[i].x < -10 ){
            friends.splice(i, 1);
            //this is where you would add logic to gain points
        }

        //actually move each cube
        friends[i].x -= 1;

        //update position
        friends[i].newPos();
        friends[i].update(); 
    } 
    
    if(loss){youLose();clearInterval(myGameArea.interval);}
}

//endgame
function youLose() {
    alert("You Lose! Reload the page a few times to restart!");
    enemies(0,enemies.length);

    //here is where you would get a custom popup
    document.getElementById('popup').style.display = "block";
    //button to start game over
    //button to go back to home page
    document.getElementById("popupForm").style.display = "none";
    document.getElementById(
'close-btn').addEventListener('click', (e) => {
            document.getElementById(
'wrapper').style.visibility = "hidden";
            window.location.reload();
        });
}

function youWin() {
    // if the goal was touched it directs here
    //button to home page
    //button to next stage
}

</script>
<p>use the arrow keys on you keyboard to move the square</p>
</body>
</html>
